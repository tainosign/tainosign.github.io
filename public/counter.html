<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>ÂÖ•Â†¥ÂÅ¥„Ç´„Ç¶„É≥„Çø„Éº</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* üí° ÁîªÈù¢ÂÖ®‰Ωì„Å´ÂÖ•Â†¥„Éú„Çø„É≥„ÇíÊúÄÂ§ßÂåñ */
        body { 
            font-family: 'Inter', sans-serif; 
            text-align: center; 
            margin: 0; 
            padding: 0; 
            background-color: #f4f4f4; 
            height: 100vh;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            touch-action: pan-y; /* „Çπ„ÇØ„É≠„Éº„É´„ÇíË®±ÂèØ */
        }

        /* --- üí° „Éò„ÉÉ„ÉÄ„ÉºÈ†òÂüü„ÅÆ„Çπ„Çø„Ç§„É´ --- */
        .header-container {
            background-color: #17a2b8; /* cyan-view */
            color: white;
            padding: 3vw 5vw; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            width: 100%;
            box-sizing: border-box;
            flex-shrink: 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        /* QR„Ç≥„Éº„Éâ„Ç≥„É≥„ÉÜ„Éä */
        .qr-code-area {
            flex-shrink: 0; 
            margin-right: 4vw; 
            width: 30vw; 
            height: auto;
            display: flex; 
            align-items: center;
            justify-content: center;
            max-width: 150px; 
        }

        /* QR„Ç≥„Éº„ÉâÁîªÂÉè */
        #qr-image {
            width: 100% !important; 
            height: auto !important; 
            border-radius: 5px;
            background-color: white; 
            padding: 5px;
            object-fit: contain; 
        }

        /* ÊÉÖÂ†±„Ç®„É™„Ç¢ÂÖ®‰Ωì */
        .info-area {
            text-align: right; 
            flex-grow: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: flex-end; 
        }

        /* ÂØæË±°Êó• */
        #target-date {
            font-size: 4.5vw; 
            margin-bottom: 0.2vw; 
            line-height: 1.2;
            white-space: nowrap; 
        }

        /* ÁèæÂú®Â†¥ÂÜÖ‰∫∫Êï∞ */
        #current-count-display { 
            font-size: 5vw; 
            font-weight: bold;
            white-space: nowrap; 
            margin-bottom: 0.5vw;
        }

        #current-count-value { 
            font-weight: bold; 
            font-size: 12vw; 
            color: #FFC107; /* ÈªÑËâ≤„ÅßÁõÆÁ´ã„Åü„Åõ„Çã */
            line-height: 1;
        }

        #wait-time-display, .total-visitors {
            font-size: 3.5vw; 
            line-height: 1.2;
        }
        #wait-time-display{
            margin-top: -1vw; 
            margin-bottom: 0.1vw; 
        }

        /* --- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑÔºà„Éú„Çø„É≥„Ç®„É™„Ç¢Ôºâ --- */
        #main-content { 
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
            padding: 4vw 5vw 2vw; 
            width: 100%; 
            margin: 0 auto;
            box-sizing: border-box;
        }
        
        /* +1 „É°„Ç§„É≥„Éú„Çø„É≥ */
        #in-btn {
            width: 100%; 
            font-size: 25vw;
            font-weight: bold;
            color: white; 
            border: none; 
            border-radius: 3vw 3vw 0 0; 
            background-color: #4CAF50; /* Á∑ë */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3); 
            cursor: pointer; 
            transition: background-color 0.1s, transform 0.1s;
            touch-action: manipulation;
            margin-bottom: 3px; 
            flex-grow: 1; 
        }
        #in-btn:active { background-color: #3e8e41; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3); transform: translateY(3px); }

        /* Ë§áÊï∞„Éú„Çø„É≥„ÅÆ„Ç≥„É≥„ÉÜ„Éä */
        .multi-count-group {
            display: flex;
            width: 100%;
            flex-shrink: 0;
            height: 15vh;
        }

        /* Ë§áÊï∞„Éú„Çø„É≥„ÅÆÂÖ±ÈÄö„Çπ„Çø„Ç§„É´ */
        .multi-count-btn {
            flex-grow: 1;
            padding: 0; 
            font-size: 10vw; 
            font-weight: bold;
            color: white;
            border: none;
            background-color: #6c757d; 
            cursor: pointer;
            transition: background-color 0.1s, transform 0.1s;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2); 
            touch-action: manipulation;
            line-height: 1; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .multi-count-btn:active { background-color: #495057; transform: translateY(2px); box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3); }

        /* +5 „Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´ */
        #in-btn-5 {
            border-radius: 0 0 0 3vw; 
            margin-right: 3px; 
        }

        /* +10 „Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´ */
        #in-btn-10 {
            border-radius: 0 0 3vw 0; 
        }

        #status { 
            flex-shrink: 0; 
            margin-top: 2vw; 
            font-size: 4vw; 
            color: #666; 
            min-height: 5vw; 
        }

        /* Êàª„Çã„Éú„Çø„É≥ */
        .back-button-container {
            flex-shrink: 0;
            width: 90vw;
            margin: 0 auto 5vw;
        }
        .back-button {
            display: block; 
            padding: 3vw 5vw; 
            background-color: #6c757d; 
            color: white; 
            border: none; 
            border-radius: 2vw; 
            text-decoration: none;
            font-size: 4vw;
            transition: background-color 0.1s;
        }
        .back-button:active {
            background-color: #495057;
        }

        .updating {
            transition: all 0.2s ease-in-out;
            color: #FFC107 !important; 
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <!-- Firebase SDK„ÅÆË™≠„ÅøËæº„Åø -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // ----------------------------------------------------
        // 1. FirebaseË®≠ÂÆö„Å®„Ç∞„É≠„Éº„Éê„É´Â§âÊï∞ 
        // ----------------------------------------------------
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Åã„ÇâË®≠ÂÆö„ÇíÂèñÂæó„Åó„ÄÅ„Å™„ÅÑÂ†¥Âêà„ÅØÁ©∫„ÅÆ„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Çí‰ΩøÁî®
        let firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // ‚òÖ‚òÖ‚òÖ „É¶„Éº„Ç∂„ÉºË¶ÅÊ±Ç„ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØË™çË®ºÊÉÖÂ†±„ÅÆÈÅ©Áî® ‚òÖ‚òÖ‚òÖ
        if (Object.keys(firebaseConfig).length === 0) {
            console.warn("Áí∞Â¢ÉÂ§âÊï∞__firebase_config„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ„Éè„Éº„Éâ„Ç≥„Éº„Éâ„Åï„Çå„ÅüË®≠ÂÆö„Çí‰ΩøÁî®„Åó„Åæ„Åô„ÄÇ");
            firebaseConfig = {
                apiKey: "AIzaSyAgLH9FWBCJy-X11vu0r3YS-VZC-B9M2xA",
                authDomain: "setapanmarketcounter.firebaseapp.com",
                databaseURL: "https://setapanmarketcounter-default-rtdb.firebaseio.com",
                projectId: "setapanmarketcounter",
                storageBucket: "setapanmarketcounter.firebasestorage.app",
                messagingSenderId: "546423839721",
                appId: "1:546423839721:web:70d5c12129fe6cc1594978",
                measurementId: "G-70KHJ0P1P1"
            };
        }

        // Êèê‰æõ„Åï„Çå„Åü„É≠„Ç∞ÊÉÖÂ†±„Åã„Çâ„Ç¢„Éó„É™ID„ÇíÂèñÂæó„Åó„ÄÅFirebase Config„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà„ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„ÇíÁ¢∫‰øù
        // projectId„Åæ„Åü„ÅØappId„Çí„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„Å®„Åó„Å¶‰ΩøÁî®
        const appId = typeof __app_id !== 'undefined' ? __app_id : firebaseConfig.projectId || firebaseConfig.appId || 'setapanmarketcounter';

        // Firestore „Éë„ÇπÂÆöÁæ© 
        // /artifacts/{appId}/public/data/log/...
        const LOG_COLLECTION_PATH = `artifacts/${appId}/public/data/log`;
        // /artifacts/{appId}/public/data/summary/counts
        const summaryDocRef = (db) => doc(db, `artifacts/${appId}/public/data/summary`, 'counts');
        // /artifacts/{appId}/public/data/static/day (Êó•‰ªòË®≠ÂÆö„Éâ„Ç≠„É•„É°„É≥„Éà)
        const dateConfigDocRef = (db) => doc(db, `artifacts/${appId}/public/data/static`, 'day');

        let db, auth, userId;
        let isProcessing = false;
        let currentEventDay = 'day1'; // „Éá„Éï„Ç©„É´„ÉàÂÄ§ÔºàÊó•‰ªòË®≠ÂÆö„ÅåÂèñÂæó„Åß„Åç„Å™„ÅÑÂ†¥ÂêàÔºâ
        
        // UIË¶ÅÁ¥† („Ç∞„É≠„Éº„Éê„É´„Çπ„Ç≥„Éº„Éó„ÅßÂèñÂæó)
        const currentCountValueEl = document.getElementById('current-count-value');
        const waitTimeValueEl = document.getElementById('wait-time-value');
        const totalVisitorsEl = document.querySelector('.total-visitors');
        const targetDateEl = document.getElementById('target-date');
        const statusElement = document.getElementById('status');


        // ----------------------------------------------------
        // 2. „Éò„ÉÉ„ÉÄ„ÉºÊÉÖÂ†±„ÅÆ„É™„Ç¢„É´„Çø„Ç§„É†Êõ¥Êñ∞„É≠„Ç∏„ÉÉ„ÇØ
        // ----------------------------------------------------
        function setupRealtimeListener(db) {
            
            // --- A. Êó•‰ªòË®≠ÂÆö„ÅÆ„É™„Ç¢„É´„Çø„Ç§„É†Áõ£Ë¶ñ ---
            onSnapshot(dateConfigDocRef(db), (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    // day1, day2„Åå„Çø„Ç§„É†„Çπ„Çø„É≥„Éó„Å®„Åó„Å¶‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Çã„Å®‰ªÆÂÆö„Åó„ÄÅÊó•‰ªòÊñáÂ≠óÂàó„Å´Â§âÊèõ
                    const day1Timestamp = data.day1; 
                    const day2Timestamp = data.day2;
                    currentEventDay = data.current_day || 'day1'; // Ë®≠ÂÆö„Éâ„Ç≠„É•„É°„É≥„Éà„Å´current_day„Éï„Ç£„Éº„É´„Éâ„Åå„ÅÇ„Çã„ÅãÁ¢∫Ë™ç

                    let day1DateStr = '---';
                    let day2DateStr = '---';
                    
                    // „Çø„Ç§„É†„Çπ„Çø„É≥„Éó„Çí„É≠„Éº„Ç´„É´„ÅÆÊó•‰ªòÊñáÂ≠óÂàó„Å´„Éï„Ç©„Éº„Éû„ÉÉ„Éà
                    if (day1Timestamp && day1Timestamp.toDate) {
                        day1DateStr = day1Timestamp.toDate().toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' });
                    }
                    if (day2Timestamp && day2Timestamp.toDate) {
                        day2DateStr = day2Timestamp.toDate().toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' });
                    }

                    // „Éò„ÉÉ„ÉÄ„ÉºUI„ÅÆÊõ¥Êñ∞
                    const displayDate = currentEventDay === 'day1' ? day1DateStr : day2DateStr;
                    targetDateEl.textContent = `ÂØæË±°Êó•: ${currentEventDay} (${displayDate})`;
                    targetDateEl.classList.remove('text-red-500'); 
                    
                } else {
                    // „Éâ„Ç≠„É•„É°„É≥„Éà„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà
                    targetDateEl.textContent = `ÂØæË±°Êó•: „Éá„Éº„Çø„Å™„Åó („Éá„Éï„Ç©„É´„Éà ${currentEventDay})`;
                    targetDateEl.classList.add('text-red-500');
                    console.warn("Êó•‰ªòË®≠ÂÆö„Éâ„Ç≠„É•„É°„É≥„Éà„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ„Éá„Éï„Ç©„É´„ÉàÂÄ§„Çí‰ΩøÁî®„Åó„Åæ„Åô„ÄÇ");
                }
            }, (error) => {
                // Êó•‰ªòË®≠ÂÆö„ÅÆË≥ºË™≠„Ç®„É©„Éº
                targetDateEl.textContent = `ÂØæË±°Êó•: ÂèñÂæóÂ§±Êïó üö®`;
                targetDateEl.classList.add('text-red-500');
                console.error("Êó•‰ªòË®≠ÂÆö„ÅÆË≥ºË™≠„Ç®„É©„Éº:", error);
            });


            // --- B. ÈõÜË®à„Çµ„Éû„É™„Éº„ÅÆ„É™„Ç¢„É´„Çø„Ç§„É†Áõ£Ë¶ñ ---
            onSnapshot(summaryDocRef(db), (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    const currentCount = data.current_count || 0;
                    
                    // 1. Â†¥ÂÜÖ‰∫∫Êï∞
                    currentCountValueEl.textContent = currentCount.toLocaleString();

                    // 2. Êù•Â†¥ËÄÖÊï∞
                    const day1 = data.day1_total_visitors || 0; 
                    const day2 = data.day2_total_visitors || 0;
                    
                    totalVisitorsEl.textContent = `1Êó•ÁõÆ: ${day1.toLocaleString()}‰∫∫ 2Êó•ÁõÆ: ${day2.toLocaleString()}‰∫∫`;

                    // 3. ÂæÖ„Å°ÊôÇÈñì
                    let waitTime = Math.max(0, Math.floor(currentCount / 50) * 5); // 50‰∫∫„Åî„Å®„Å´5ÂàÜËøΩÂä†
                    waitTimeValueEl.textContent = `${waitTime}ÂàÜ`;
                } else {
                    currentCountValueEl.textContent = '0';
                    totalVisitorsEl.textContent = '1Êó•ÁõÆ: 0‰∫∫ 2Êó•ÁõÆ: 0‰∫∫';
                    waitTimeValueEl.textContent = '--ÂàÜ';
                }
            }, (error) => {
                // ÈõÜË®à„Éá„Éº„Çø„ÅÆË≥ºË™≠„Ç®„É©„Éº
                if (error.message.includes("permission")) {
                    statusElement.textContent = 'üö® „Éá„Éº„ÇøÂèñÂæóÂ§±Êïó: Firestore„Çª„Ç≠„É•„É™„ÉÜ„Ç£„É´„Éº„É´„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                    console.error("Firestore Permission Error:", error);
                } else {
                    statusElement.textContent = `üö® „Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº: ${error.message.substring(0, 50)}...`;
                    console.error("Data Listener Error:", error);
                }
                currentCountValueEl.textContent = 'ÂèñÂæóÂ§±Êïó';
            });
        }

        // ----------------------------------------------------
        // 3. „Ç´„Ç¶„É≥„Çø„ÉºÊ©üËÉΩ („É≠„Ç∞Êõ∏„ÅçËæº„Åø)
        // ----------------------------------------------------
        
        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£: „Ç®„É©„ÉºË°®Á§∫
        function displayError(message) {
            console.error(message);
            statusElement.textContent = `üö® „Ç®„É©„Éº: ${message.substring(0, 50)}...`;
            // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Ëß£Èô§
            currentCountValueEl.classList.remove('updating');
            isProcessing = false;
        }

        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£: „Ç´„Ç¶„É≥„Çø„Éº„Éú„Çø„É≥„ÅÆÊìç‰ΩúÈñ¢Êï∞
        window.handleButtonClick = async function(count = 1) {
            if (isProcessing) {
                statusElement.textContent = 'Âá¶ÁêÜ‰∏≠„Åß„Åô...';
                return;
            }
            
            // üö® Ë™çË®º„ÅåÂ§±Êïó„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅÂá¶ÁêÜ„Çí‰∏≠Êñ≠
            if (!userId) {
                statusElement.textContent = 'üö® Ë™çË®º„ÅåÊú™ÂÆå‰∫Ü„ÅÆ„Åü„ÇÅ„ÄÅË®òÈå≤„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„Éö„Éº„Ç∏„Çí„É™„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
                return;
            }

            isProcessing = true;
            const countButtons = document.querySelectorAll('#in-btn, .multi-count-btn');

            // 1. UI„ÅÆÊõ¥Êñ∞ÔºàÊö´ÂÆöÂÄ§„Å®„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Ôºâ
            countButtons.forEach(btn => btn.disabled = true);
            statusElement.textContent = `ÂÖ•Â†¥ (+${count}‰∫∫) „ÇíË®òÈå≤‰∏≠...`;

            // Êö´ÂÆöÁöÑ„Å™Â†¥ÂÜÖ‰∫∫Êï∞Ë°®Á§∫Êõ¥Êñ∞
            const currentCountText = currentCountValueEl.textContent;
            const currentCount = parseInt(currentCountText.replace(/[,\u3000-]/g, ''), 10) || 0;
            const newCount = Math.max(0, currentCount + count); 
            
            currentCountValueEl.textContent = newCount.toLocaleString();
            currentCountValueEl.classList.add('updating'); 

            try {
                // „É≠„Ç∞„ÅÆÊõ∏„ÅçËæº„Åø
                const logData = {
                    type: 'in', // ÂÖ•Â†¥Â∞ÇÁî®
                    count: count, 
                    timestamp: serverTimestamp(), // FirestoreÂÅ¥„ÅßÊ≠£Á¢∫„Å™ÊôÇÂàª„ÇíË®òÈå≤
                    recorded_by_uid: userId,
                    event_day: currentEventDay, // „É™„Ç¢„É´„Çø„Ç§„É†„Å´ÂèñÂæó„Åó„ÅüÊó•‰ªòË®≠ÂÆö„ÇíÂèçÊò†
                };
                
                // „É≠„Ç∞„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„Å´ËøΩÂä†
                await addDoc(collection(db, LOG_COLLECTION_PATH), logData);

                statusElement.textContent = `‚úÖ ÂÖ•Â†¥ (+${count}‰∫∫) Ë®òÈå≤ÂÆå‰∫ÜÔºÅ`;

            } catch (error) {
                // Ê®©Èôê„Ç®„É©„Éº„ÅÆÂ†¥Âêà„ÄÅÂÖ∑‰ΩìÁöÑ„Å™„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂá∫„Åô
                if (error.message.includes("permission")) {
                    displayError('Ë®òÈå≤Â§±Êïó: „Çª„Ç≠„É•„É™„ÉÜ„Ç£„É´„Éº„É´„Å´„Çà„ÇäÊõ∏„ÅçËæº„Åø„ÅåÊãíÂê¶„Åï„Çå„Åæ„Åó„Åü„ÄÇ');
                } else {
                    displayError(`„É≠„Ç∞„ÅÆË®òÈå≤„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${error.message}`);
                }
            } finally {
                // „Éú„Çø„É≥„ÇíÂÜçÊúâÂäπÂåñ„Åó„ÄÅ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíËß£Èô§
                setTimeout(() => {
                    countButtons.forEach(btn => btn.disabled = false);
                    isProcessing = false;
                    currentCountValueEl.classList.remove('updating');
                    // „É™„Ç¢„É´„Çø„Ç§„É†„É™„Çπ„Éä„Éº„ÅåÊúÄÁµÇÁöÑ„Å™ÂÄ§„ÇíÊõ¥Êñ∞„Åô„Çã„ÅÆ„ÇíÂæÖ„Å§
                }, 500);
            }
        }

        // ----------------------------------------------------
        // 4. „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÈñãÂßã
        // ----------------------------------------------------
        async function initializeAppAndAuth() {
            // UI„ÅÆÂàùÊúü„É°„ÉÉ„Çª„Éº„Ç∏
            statusElement.textContent = '„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ‰∏≠...';

            try {
                // Config„ÅØ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ„É≠„Ç∏„ÉÉ„ÇØ„Å´„Çà„ÇäÂøÖ„ÅöÂ≠òÂú®„Åô„Çã„Åü„ÇÅ„ÄÅ„Åì„Åì„ÅßConfig„ÅÆÊúâÁÑ°„ÉÅ„Çß„ÉÉ„ÇØ„ÅØË°å„Çè„Å™„ÅÑ
                
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Ë™çË®º
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                // Ë™çË®ºÊàêÂäüÊôÇ
                if (auth.currentUser) {
                    userId = auth.currentUser.uid;
                    // ÂÆåÂÖ®„Å™UID„ÅØÈï∑„ÅÑ„Åü„ÇÅ„ÄÅÊúÄÂàù„ÅÆ8ÊñáÂ≠ó„ÅÆ„ÅøË°®Á§∫ÔºàÁÆ°ÁêÜËÄÖ„ÅÆ„Åø„ÅåÂÆåÂÖ®„Å™ID„Çí‰ΩøÁî®Ôºâ
                    statusElement.textContent = `Êé•Á∂öÊàêÂäü„ÄÇ„É¶„Éº„Ç∂„ÉºID: ${userId.substring(0, 8)}...`;
                    
                    // Ë™çË®ºÂæå„ÄÅ„É™„Ç¢„É´„Çø„Ç§„É†„É™„Çπ„Éä„Éº„ÇíÈñãÂßã
                    setupRealtimeListener(db);
                } else {
                    throw new Error("User authentication failed and currentUser is null.");
                }
                
            } catch (e) {
                let errorMessage = `FirebaseÂàùÊúüÂåñ„Åæ„Åü„ÅØË™çË®º„Ç®„É©„Éº: ${e.message}`;
                displayError(errorMessage);
                userId = null; 
            }
        }

        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆÈñãÂßã
        window.onload = initializeAppAndAuth;
    </script>

    <header class="header-container">
        <div class="qr-code-area">
            <!-- QR„Ç≥„Éº„Éâ„ÅÆ„É¢„ÉÉ„ÇØ: Firebase„Åß„ÅØÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Å™„ÅÑ„Åü„ÇÅ„ÄÅ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„Çí‰ΩøÁî® -->
            <img id="qr-image" 
                         src='https://placehold.co/150x150/FFFFFF/AAAAAA?text=QR+Code' 
                         alt="QR Code" 
                         onerror="this.src='https://placehold.co/150x150/FFFFFF/AAAAAA?text=QR+Code'" 
            > 
        </div>

        <div class="info-area">
            <!-- ÂØæË±°Êó•„ÅÆÂàùÊúüÂÄ§„ÅØ„ÄÅJS„Åß‰∏äÊõ∏„Åç„Åï„Çå„Çã„Åæ„Åß„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„Å®„Åô„Çã -->
            <div id="target-date">ÂØæË±°Êó•: ---</div> 
            <div id="current-count-display">Â†¥ÂÜÖ‰∫∫Êï∞: <span id="current-count-value">0</span></div>
            <div id="wait-time-display">100‰∫∫ÂΩì„Åü„ÇäÂæÖ„Å°ÊôÇÈñì: <span id="wait-time-value">--ÂàÜ</span></div>
            <div class="total-visitors">
                1Êó•ÁõÆ: 0‰∫∫ 2Êó•ÁõÆ: 0‰∫∫
            </div>
        </div>
    </header>

    <div id="main-content">
        <!-- handleButtonClick(count) „ÅÆÂºïÊï∞„ÅØ„Ç´„Ç¶„É≥„ÉàÊï∞„ÅÆ„Åø„Å´Â§âÊõ¥ -->
        <button id="in-btn" class="count-button" onclick="handleButtonClick(1)">+1</button>
        
        <div class="multi-count-group">
            <button id="in-btn-5" class="multi-count-btn" onclick="handleButtonClick(5)">+5</button>
            <button id="in-btn-10" class="multi-count-btn" onclick="handleButtonClick(10)">+10</button>
        </div>
        
        <div id="status">„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ‰∏≠...</div>
    </div>

    <div class="back-button-container">
        <!-- „É°„Éã„É•„Éº„Éö„Éº„Ç∏„Å∏„ÅÆ„É™„É≥„ÇØ„ÅØ„ÄÅindex.html„Å∏ÈÅ∑Áßª„Åô„Çã„Çà„ÅÜ„Å´Âõ∫ÂÆö -->
        <a href="./index.html" class="back-button">„É°„Éã„É•„Éº„Å∏Êàª„Çã</a>
    </div>
</body>
</html>
